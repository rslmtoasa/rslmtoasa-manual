.. _examples/surface_fcccu001:

===================================
Surface: fcc Cu(001)
===================================

**Location:** ``example/surface/fccCu001/``

**System:** Cu(001) surface with 6 atomic layers

**Physics:** Demonstrates semi-infinite surface calculation with layer-dependent electronic structure.

Overview
========

This example shows how to set up a surface calculation using:

- ``pre_processing = 'buildsurf'`` - Auto-generate surface geometry
- ``calctype = 'S'`` - Surface boundary conditions
- ``nlay = 6`` - Number of surface layers
- Layer-specific atom types for surface, subsurface layers

Files
=====

- ``input.nml`` - Main parameters
- ``Cu_scf.nml`` - Bulk Cu parameters
- ``Cu-S_scf.nml`` - Surface layer Cu
- ``Cu-S-1_scf.nml`` through ``Cu-S-4_scf.nml`` - Subsurface layers
- ``ES_scf.nml`` - Empty sphere at surface

Input File: input.nml
=====================

.. code-block:: fortran

   &calculation
   pre_processing = 'buildsurf'  ! ← Build surface geometry
   verbose = T
   /
   
   &lattice
   rc = 100                      ! Larger cluster for surface
   alat = 3.614                  ! FCC Cu lattice constant
   crystal_sym = 'fcc'
   wav = 1.41237
   nlay = 6                      ! ← 6 atomic layers
   surftype = '0 0 1'            ! ← (001) surface orientation
   ntype = 7                     ! Bulk + surface + subsurface types
   ct(:) = 7*4.0d0
   r2 = 16.0d0
   /
   
   &atoms
   database = './'
   label(1) = 'Cu'               ! Bulk Cu
   label(2) = 'ES'               ! Empty sphere
   label(3) = 'Cu-S'             ! Surface layer
   label(4) = 'Cu-S-1'           ! Subsurface layer 1
   label(5) = 'Cu-S-2'           ! Layer 2
   label(6) = 'Cu-S-3'           ! Layer 3
   label(7) = 'Cu-S-4'           ! Layer 4
   /
   
   &self
   ws_all = .true.               ! Calculate WS radius for all atoms
   nstep = 500                   ! Many iterations for surface
   /
   
   &energy
   fermi = -0.088376
   energy_min = -1.0
   energy_max = 1.2
   channels_ldos = 2500
   fix_fermi = .true.            ! ← Fix Fermi level
   /
   
   &control
   calctype = 'S'                ! ← Surface calculation
   nsp = 2
   lld = 21
   recur = 'block'
   /
   
   &mix
   beta = 0.0020                 ! ← Very small mixing for stability
   mixtype = 'broyden'
   /

Critical Surface Parameters
---------------------------

- ``pre_processing = 'buildsurf'``: Automatically constructs surface from bulk structure
- ``calctype = 'S'``: **Surface** calculation (semi-infinite boundary conditions)
- ``nlay = 6``: Number of explicit atomic layers perpendicular to surface
- ``surftype = '0 0 1'``: Miller indices for (001) surface
- ``fix_fermi = .true.``: Keep Fermi energy fixed (important for surfaces)
- ``beta = 0.0020``: Very small mixing required for surface convergence
- ``ws_all = .true.``: Recalculate WS radii for all atoms (surface has different coordination)

No lattice.nml Needed
=====================

The surface geometry is auto-generated by ``pre_processing = 'buildsurf'`` from:

- Bulk crystal structure (``crystal_sym = 'fcc'``)
- Surface orientation (``surftype``)
- Number of layers (``nlay``)

**Generated structure:**

.. code-block:: text

   Vacuum (semi-infinite)
   ----------------------
   Cu-S       ← Surface layer (coordination 4 → reduced from bulk 12)
   Cu-S-1     ← Subsurface layer 1
   Cu-S-2     ← Subsurface layer 2
   Cu-S-3     ← Subsurface layer 3
   Cu-S-4     ← Subsurface layer 4
   Cu         ← Bulk-like layer
   Cu         ← Bulk continues...
   ...
   (semi-infinite bulk)

Atom Parameters
===============

Surface atoms require separate parameters due to reduced coordination.

**Cu-S_scf.nml** (surface layer):

.. code-block:: fortran

   &element
   symbol = 'Cu-S'               ! Surface Cu
   atomic_number = 29
   core = 18
   valence = 11                  ! 3d¹⁰4s¹
   /
   
   &par
   lmax = 2
   
   ! Surface parameters differ from bulk:
   ! - Narrower d-band (reduced coordination)
   ! - Different charge distribution
   ! - Modified band center
   
   center_band(:, 1) = -0.285, 0.412, -0.195
   width_band(:, 1) = 0.390, 0.255, 0.125
   /

**Physical effects:**

- d-band narrowing at surface
- Surface states
- Charge redistribution

Running the Calculation
=======================

.. code-block:: bash

   cd example/surface/fccCu001
   ../../../../build/bin/rslmto.x

Expected Output
===============

**Convergence:** 100-300 iterations (surfaces are slow to converge).

**Layer-dependent properties:**

.. code-block:: bash

   grep "charge" Cu-S*_out.nml   # Surface/subsurface charges
   grep "charge" Cu_out.nml      # Bulk charge for comparison

Expected: Surface charge slightly enhanced (~0.1-0.2%) vs bulk.

**Expected runtime:** 10-20 minutes.

Troubleshooting
===============

**Very slow/no convergence:**

1. Reduce ``beta`` further: 0.001 or 0.0005
2. Increase ``nstep`` to 1000
3. Check ``fix_fermi = .true.`` is set

**Unphysical surface charge:**

- Verify ``ws_all = .true.``
- Check surface atom parameters are reasonable
- Increase ``rc`` (cluster size)

Physical Interpretation
=======================

Cu(001) surface shows:

- **Shockley surface states** near Fermi level
- d-band center shifts upward at surface
- Reduced coordination → narrower d-bands
- Important for catalysis and surface chemistry

See Also
========

- :doc:`bulk_si` - Periodic bulk calculation
- :doc:`impurity_b2feco` - Embedded cluster calculation
- :doc:`../../keywords/lattice_geometry` - Surface parameters
- :doc:`../../keywords/scf_settings` - fix_fermi parameter
